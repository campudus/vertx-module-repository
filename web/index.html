<!DOCTYPE html>
<html>
<head>
<title>Vert.x Module Registry</title>
<link rel="stylesheet" type="text/css" href="/css/normalize.css" />
<link rel="stylesheet" type="text/css" href="/css/main.css" />
<script src="js/jquery.js" type="text/javascript"></script>
<script>
  function fillLatestApprovedModules() {
    $.getJSON('/latest-approved-modules', function(data) {
      var item, items = '<ul>', modules = data.modules;
      while (modules.length) {
        item = modules.pop();
        items += '<li><span class="date">' + item.timeApproved
            + '</span> - <a href="' + item.projectUrl + '">' + item.owner + '~' + item.name + '~'
            + item.version + '</a></li>';
      }
      items += '</ul>';
      $('#latestApprovedModules').append(items);
    });
  }

  function createSearchFormSubmitHandler() {
    $('#searchForm').submit(
        function(event) {
          event.preventDefault();

          $.post('/search', {
            query : $('#query').val()
          }, function(data) {
            var item, items = '<ul>', modules = data.modules;
            while (modules.length) {
              item = modules.pop();
              items += '<li><a href="' + item.projectUrl + '">' + item.owner + '~' + item.name
                  + '~' + item.version + '</a></li>';
            }
            items += '</ul>';
            console.log('data: ' + JSON.stringify(data));
            $('#searchResults').empty();
            $('#searchResults').append(items);
            $('#searchResultContainer').show();
          }, 'json');
        });
  }

  $(document).ready(function() {
    fillLatestApprovedModules();
    createSearchFormSubmitHandler();
  });
</script>
</head>
<body>
	<h1>Vert.x Module Registry</h1>
	<p>This is the Vert.x module registry. Here you can find all modules published by Vert.x users.</p>
	<div id="search">
		<h2>Search</h2>
		<div id="searchForModules">
			<form action="/search" method="post" id="searchForm">
				<fieldset>
					<legend>Search for modules</legend>
					<div>
						<input type="text" name="query" placeholder="Query for modules" id="query"/>
					</div>
					<button type="submit">Search</button>
				</fieldset>
			</form>
		</div>
		<div id="searchResultContainer">
			<h2>Search results</h2>
			<div id="searchResults"></div>
		</div>
	</div>
	<div id="stats">
		<h2>Latest approved modules</h2>
		<div id="latestApprovedModules"></div>
	</div>
	<div id="further">
		<h2>Register your own module</h2>
		<p>
			To register your own module, simply fill out the <a href="/register">registration form</a>.
		</p>
	</div>
</body>
</html>